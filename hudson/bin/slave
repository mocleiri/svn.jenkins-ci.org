#!/bin/sh
# Usage: slave <workdir> <envvar1> <value1> <envvar2> <value2> ... -- <command> <arg> ...
#
#  This wrapper is used to launch a process remotely with some environment variables
#  set.

# if there's any environment entries read them
if [ -e ~/.hudson_slave_profile ];
then
  source ~/.hudson_slave_profile
fi`

# set the current directory
cd $1
shift

# fill in environment variables
while [ $# -gt 1 -a "$1" != "--" ];
do
  eval $1="$2"
  export $1
  shift 2
done

if [ "$1" != "--" ];
then
  echo Error: no command given
  exit -1
fi

shift

# execute. use eval so that variables can be expanded now
eval exec "$@"
