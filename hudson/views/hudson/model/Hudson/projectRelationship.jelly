<!--
  Displays two projects side by side and show their relationship
-->
<j:jelly xmlns:j="jelly:core" xmlns:st="jelly:stapler" xmlns:d="jelly:define" xmlns:l="/lib/layout" xmlns:t="/lib/hudson" xmlns:f="/lib/form">
  <l:layout>
    <st:include page="sidepanel.jelly" />
    <l:main-panel>
      <h1><img src="${rootURL}/images/48x48/search.gif" />Project Rlatipnship</h1>
      <form action="projectRelationship" method="get">
        <table width="100%">
          <tr>
            <j:set var="names" value="${app.jobNames}" />
            <td style="text-align:right;">
              upstream project:
              <f:editableComboBox id="lhs" name="lhs" value="${request.getParameter('lhs')}" items="${names}" />
            </td>
            <td style="width:32px; text-align:center;"><img src="${rootURL}/images/24x24/next.gif" alt="->"/></td>
            <td>
              downstream project:
              <f:editableComboBox id="rhs" name="rhs" value="${request.getParameter('rhs')}" items="${names}" />
            </td>
          </tr>
          <tr>
            <td colspan="3" style="text-align:right">
              <input type="submit" value="Compare" />
              <a href="projectRelationship-help"><img src="${rootURL}/images/16x16/help.gif" /></a>
            </td>
          </tr>

          <j:if test="${!empty(param.lhs) and !empty(param.rhs)}">
            <j:set var="jl" value="${h.getJob(request.getParameter('lhs'))}" />
            <j:set var="jr" value="${h.getJob(request.getParameter('rhs'))}" />

            <j:choose>
              <j:when test="${jl==null}">
                <tr><td colspan="3" class="error">
                  No such project '${request.getParameter('lhs')}'
                </td></tr>
              </j:when>
              <j:when test="${jr==null}">
                <tr><td colspan="3" class="error">
                  No such project '${request.getParameter('rhs')}'
                </td></tr>
              </j:when>
              <j:otherwise>
                <j:forEach var="e" items="${h.getProjectRelationshipMap(jl,jr)}">
                  <tr>
                    <td style="text-align:right">
                      <t:buildLink job="${jl}" number="${e.key}"/>
                    </td>
                    <td><st:nbsp/></td>
                    <td>
                      <t:buildRangeLink job="${jr}" range="${e.value}"/>
                    </td>
                  </tr>
                </j:forEach>
              </j:otherwise>
            </j:choose>
          </j:if>
        </table>
      </form>
    </l:main-panel>
  </l:layout>
</j:jelly>
