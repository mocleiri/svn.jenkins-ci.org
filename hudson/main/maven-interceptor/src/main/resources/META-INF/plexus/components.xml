<!--
  Override the plugin manager.

  TODO: this is fragile, as newer versions of Maven may add more <requirement>s
  or change configuration. Figure out how to do interception in plexus.

  Component definition is available in this module, to ensure that
  this component descriptor will be picked up first before any of the built-in
  maven components kick in.
-->
<component-set>
  <components>
    <component>
      <role>org.apache.maven.plugin.PluginManager</role>
      <implementation>hudson.maven.agent.PluginManagerInterceptor</implementation>
      <requirements>
        <requirement>
          <role>org.apache.maven.project.path.PathTranslator</role>
        </requirement>
        <requirement>
          <role>org.apache.maven.plugin.MavenPluginCollector</role>
        </requirement>
        <requirement>
          <role>org.apache.maven.plugin.version.PluginVersionManager</role>
        </requirement>
        <requirement>
          <role>org.apache.maven.artifact.factory.ArtifactFactory</role>
        </requirement>
        <requirement>
          <role>org.apache.maven.artifact.resolver.ArtifactResolver</role>
        </requirement>
        <requirement>
          <role>org.apache.maven.artifact.metadata.ArtifactMetadataSource</role>
        </requirement>
        <requirement>
          <role>org.apache.maven.plugin.PluginMappingManager</role>
        </requirement>
        <requirement>
          <role>org.apache.maven.execution.RuntimeInformation</role>
        </requirement>
        <requirement>
          <role>org.apache.maven.project.MavenProjectBuilder</role>
        </requirement>
      </requirements>
    </component>

    <component>
      <role>org.apache.maven.lifecycle.LifecycleExecutor</role>
      <implementation>org.apache.maven.lifecycle.LifecycleExecutorInterceptor</implementation>
      <requirements>
        <requirement>
          <role>org.apache.maven.context.BuildContextManager</role>
        </requirement>
        <requirement>
          <role>org.apache.maven.plugin.loader.PluginLoader</role>
        </requirement>
        <requirement>
          <role>org.apache.maven.plugin.PluginManager</role>
        </requirement>
        <requirement>
          <role>org.apache.maven.artifact.handler.manager.ArtifactHandlerManager</role>
        </requirement>
        <requirement>
          <role>org.apache.maven.lifecycle.plan.BuildPlanner</role>
        </requirement>
        <requirement>
          <role>org.apache.maven.lifecycle.binding.MojoBindingFactory</role>
        </requirement>
      </requirements>

    </component>
  </components>
</component-set>
