<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ko">
<head>
<meta http-equiv="Content-Type" content="text/html;charset=UTF-8" />
<title>Test Results</title>
<link rel="stylesheet" type="text/css" href="../../../lib/test/JSSpec.css" />
<script type="text/javascript" src="../../../lib/test/js/diff_match_patch.js"></script>
<script type="text/javascript" src="../../../lib/test/js/JSSpec.js"></script>
<script type="text/javascript" src="../../../lib/test/js/jsmock.js"></script>
<script type="text/javascript" src="../../../lib/main/js/date.js"></script>
<script type="text/javascript" src="../../../lib/main/js/Base.js"></script>
<script type="text/javascript" src="../../../src/main/js/core/util.js"></script>
<script type="text/javascript" src="../../../src/main/js/core/build.js"></script>
<script type="text/javascript" src="../../../src/main/js/core/historicbuild.js"></script>
<script type="text/javascript" src="../../../src/main/js/core/executorbuild.js"></script>
<script type="text/javascript" src="../../../src/main/js/core/feed.js"></script>
<script type="text/javascript" src="../../../src/main/js/core/feedresult.js"></script>
<script type="text/javascript" src="../../../src/main/js/core/feedparser.js"></script>
<script type="text/javascript" src="../../../src/main/js/core/historicfeedparser.js"></script>
<script type="text/javascript" src="../../../src/main/js/core/executorfeedparser.js"></script>
<script type="text/javascript" src="../../../src/main/js/core/downloader.js"></script>
<script type="text/javascript" src="../../../src/main/js/core/menuitem.js"></script>
<script type="text/javascript" src="../../../src/main/js/core/service.js"></script>
<script type="text/javascript" src="../../../src/main/js/core/logger.js"></script>
<script type="text/javascript" src="../../../src/main/js/core/notification.js"></script>
<script type="text/javascript" src="../../../src/main/js/core/preferences.js"></script>
<script type="text/javascript" src="../../../src/main/js/core/feednotifier.js"></script>
<script type="text/javascript" src="../../../src/main/js/core/historicfeednotifier.js"></script>
<script type="text/javascript" src="../../../src/main/js/core/executorfeednotifier.js"></script>
<script type="text/javascript" src="../../../src/main/js/firefox/uiutil.js"></script>
<script type="text/javascript" src="../../../src/main/js/firefox/localiser.js"></script>
<script type="text/javascript" src="../../../src/main/js/firefox/loggerservice.js"></script>
<script type="text/javascript" src="../../../src/main/js/firefox/notificationservice.js"></script>
<script type="text/javascript" src="../../../src/main/js/firefox/preferencesservice.js"></script>
<script type="text/javascript">// <![CDATA[

//////////////////////////////////////////////////////////////////////// core
////////////////////////////////////////////////////////////////////////

var lastFailDate = Date.parseExact('2009-08-22T03:27:41Z', 'yyyy-MM-ddTHH:mm:ssZ');

//////////////////////////////////////////////////////////////////////// historicbuild
var historicBuildDate = Date.parseExact('2009-06-02T07:41:38Z', 'yyyy-MM-ddTHH:mm:ssZ');
var historicBuild = new HudsonHistoricBuild('MyJob (SUCCESS)', 'http://localhost/hudson/job/MyJob/118/', historicBuildDate);
describe('HistoricBuild', {
	'should return correct name': function() {
		value_of(historicBuild.getName()).should_be('MyJob (SUCCESS)');
	},
	'should return correct url': function() {
		value_of(historicBuild.getUrl()).should_be('http://localhost/hudson/job/MyJob/118/');
	},
	'should return correct date': function() {
		value_of(historicBuild.getDate().toString('dd-MM-yyyy hh:mm:ss')).should_be('02-06-2009 07:41:38');
	},
	'should return correct status': function() {
		value_of(historicBuild.getStatus()).should_be('success');
	},
	'should be true on isSuccess': function() {
		value_of(historicBuild.isSuccess()).should_be_true();
	},
	'should be false on isFailure': function() {
		value_of(historicBuild.isFailure()).should_be_false();
	}
})

//////////////////////////////////////////////////////////////////////// executorbuild
var executorBuild = new HudsonExecutorBuild('MyJob', 'http://localhost/hudson/job/MyJob/118/', 42, false, false, 'master#1');
describe('ExecutorBuild', {
	'should return correct name': function() {
		value_of(executorBuild.getName()).should_be('MyJob');
	},
	'should return correct url': function() {
		value_of(executorBuild.getUrl()).should_be('http://localhost/hudson/job/MyJob/118/');
	},
	'should return correct progress': function() {
		value_of(executorBuild.getProgress()).should_be(42);
	},
	'should return correct idle status': function() {
		value_of(executorBuild.getIdle()).should_be_false();
	},
	'should return correct stuck status': function() {
		value_of(executorBuild.getStuck()).should_be_false();
	},
	'should return correct executor name': function() {
		value_of(executorBuild.getExecutorName()).should_be('master#1');
	},
	'should return correct details': function() {
		value_of(executorBuild.getDetails()).should_be('42% - MyJob - master#1');
	},
	'should return correct status': function() {
		value_of(executorBuild.getStatus()).should_be('running');
	},
})

//////////////////////////////////////////////////////////////////////// feed
var instanceFeed = new HudsonFeed(0, 'Instance Feed', 'http://localhost/hudson/rssAll', lastFailDate);
describe('Instance Feed', {
	'should be false on isJob': function() {
		value_of(instanceFeed.isJob()).should_be_false();
	},
	'should be false on isView': function() {
		value_of(instanceFeed.isView()).should_be_false();
	},
	'should return correct id': function() {
		value_of(instanceFeed.getId()).should_be(0);
	},
	'should return correct name': function() {
		value_of(instanceFeed.getName()).should_be('Instance Feed');
	},
	'should return correct url': function() {
		value_of(instanceFeed.getUrl()).should_be('http://localhost/hudson/rssAll');
	},
	'should return correct host name': function() {
		value_of(instanceFeed.getHostName()).should_be('localhost');
	},
	'should return correct item name': function() {
		value_of(instanceFeed.getItemName()).should_be_null();
	},
	'should return correct executor url': function() {
		value_of(instanceFeed.getExecutorUrl()).should_be('http://localhost/hudson/computer/api/xml?depth=1');
	},
	'should return correct dashboard url': function() {
		value_of(instanceFeed.getDashboardUrl()).should_be('http://localhost/hudson/');
	},
	'should be false on isIgnored': function() {
		value_of(instanceFeed.isIgnored()).should_be_false();
	}
})
var jobFeed = new HudsonFeed(0, 'My Feed', 'http://localhost/hudson/job/MyJob/rssAll', lastFailDate);
describe('Job Feed', {
	'should be true on isJob': function() {
		value_of(jobFeed.isJob()).should_be_true();
	},
	'should be false on isView': function() {
		value_of(jobFeed.isView()).should_be_false();
	},
	'should return correct id': function() {
		value_of(jobFeed.getId()).should_be(0);
	},
	'should return correct name': function() {
		value_of(jobFeed.getName()).should_be('My Feed');
	},
	'should return correct url': function() {
		value_of(jobFeed.getUrl()).should_be('http://localhost/hudson/job/MyJob/rssAll');
	},
	'should return correct host name': function() {
		value_of(jobFeed.getHostName()).should_be('localhost');
	},
	'should return correct item name': function() {
		value_of(jobFeed.getItemName()).should_be('MyJob');
	},
	'should return correct executor url': function() {
		value_of(jobFeed.getExecutorUrl()).should_be('http://localhost/hudson/computer/api/xml?depth=1');
	},
	'should return correct dashboard url': function() {
		value_of(jobFeed.getDashboardUrl()).should_be('http://localhost/hudson/job/MyJob/');
	},
	'should return correct build url': function() {
		value_of(jobFeed.getBuildUrl()).should_be('http://localhost/hudson/job/MyJob/build?delay=0sec');
	},
	'should be false on isIgnored': function() {
		value_of(jobFeed.isIgnored()).should_be_false();
	}
})
var viewFeed = new HudsonFeed(1, 'Your Feed', 'http://localhost/hudson/view/MyView/rssLatest', lastFailDate);
describe('View Feed', {
	'should be false on isJob': function() {
		value_of(viewFeed.isJob()).should_be_false();
	},
	'should be true on isView': function() {
		value_of(viewFeed.isView()).should_be_true();
	},
	'should return correct host name': function() {
		value_of(viewFeed.getHostName()).should_be('localhost');
	},
	'should return correct item name': function() {
		value_of(viewFeed.getItemName()).should_be('MyView');
	},
	'should return correct executor url': function() {
		value_of(viewFeed.getExecutorUrl()).should_be('http://localhost/hudson/computer/api/xml?depth=1');
	},
	'should return correct dashboard url': function() {
		value_of(viewFeed.getDashboardUrl()).should_be('http://localhost/hudson/view/MyView/');
	},
	'should be false on isIgnored': function() {
		value_of(jobFeed.isIgnored()).should_be_false();
	}
})
var invalidFeed = new HudsonFeed(2, 'Their Feed', 'http://externalhost/feed/atom', lastFailDate);
describe('Invalid Feed', {
	'should return null item name': function() {
		value_of(invalidFeed.getItemName()).should_be_null();
	},
	'should be false on isIgnored': function() {
		value_of(jobFeed.isIgnored()).should_be_false();
	}
})
var ignoredFeedWithEmptyUrl = new HudsonFeed(3, 'Whos Feed', '', lastFailDate);
var ignoredFeedWithNullUrl = new HudsonFeed(3, 'Whos Feed', null, lastFailDate);
describe('Ignored Feed', {
	'should be true on isIgnored when url is empty': function() {
		value_of(ignoredFeedWithEmptyUrl.isIgnored()).should_be_true();
	},
	'should be true on isIgnored when url is null': function() {
		value_of(ignoredFeedWithNullUrl.isIgnored()).should_be_true();
	}
})

var emptyFeedWithEmptyNameAndUrl = new HudsonFeed(0, '', '', lastFailDate);
var emptyFeedWithNullNameAndUrl = new HudsonFeed(0, null, null, lastFailDate); 
var nonEmptyFeedWithEmptyName = new HudsonFeed(0, '', 'http://localhost/hudson/view/MyView/rssLatest', lastFailDate);
var nonEmptyFeedWithNullName = new HudsonFeed(0, null, 'http://localhost/hudson/view/MyView/rssLatest', lastFailDate);
var nonEmptyFeedWithEmptyUrl = new HudsonFeed(0, 'The Feed', '', lastFailDate);
var nonEmptyFeedWithNullUrl = new HudsonFeed(0, 'The Feed', null, lastFailDate);
var nonEmptyFeedWithNullUrl = new HudsonFeed(0, 'The Feed', 'http://localhost/hudson/view/MyView/rssLatest', lastFailDate);
describe('Empty Feed', {
	'should be true on isEmpty when both name and url are empty': function() {
		value_of(emptyFeedWithEmptyNameAndUrl.isEmpty()).should_be_true();
	},
	'should be true on isEmpty when both name and url are null': function() {
		value_of(emptyFeedWithNullNameAndUrl.isEmpty()).should_be_true();
	},
	'should be false on isEmpty when name is empty': function() {
		value_of(nonEmptyFeedWithEmptyName.isEmpty()).should_be_false();
	},
	'should be false on isEmpty when name is null': function() {
		value_of(nonEmptyFeedWithNullName.isEmpty()).should_be_false();
	},
	'should be false on isEmpty when url is empty': function() {
		value_of(nonEmptyFeedWithEmptyUrl.isEmpty()).should_be_false();
	},
	'should be false on isEmpty when url is null': function() {
		value_of(nonEmptyFeedWithNullUrl.isEmpty()).should_be_false();
	},
	'should be false on isEmpty when both name and url are not null': function() {
		value_of(nonEmptyFeedWithNullUrl.isEmpty()).should_be_false();
	}
})

//////////////////////////////////////////////////////////////////////// historicfeedparser
var historicFeedXml = '<feed xmlns="http://www.w3.org/2005/Atom"><title>vysper-trunk-jdk1.6-solaris all builds</title><link type="text/html" rel="alternate" href="http://hudson.zones.apache.org/hudson/job/vysper-trunk-jdk1.6-solaris/"></link><updated>2009-06-01T19:36:43Z</updated><author><name>Hudson Server</name></author><id>urn:uuid:903deee0-7bfa-11db-9fe1-0800200c9a66</id><entry><title>vysper-trunk-jdk1.6-solaris #22 (SUCCESS)</title><link type="text/html" rel="alternate" href="http://hudson.zones.apache.org/hudson/job/vysper-trunk-jdk1.6-solaris/22/"></link><id>tag:hudson.dev.java.net,2009:vysper-trunk-jdk1.6-solaris:2009-06-01_19-36-43</id><published>2009-06-01T19:36:43Z</published><updated>2009-06-01T19:36:43Z</updated></entry><entry><title>vysper-trunk-jdk1.6-solaris #21 (SUCCESS)</title><link type="text/html" rel="alternate" href="http://hudson.zones.apache.org/hudson/job/vysper-trunk-jdk1.6-solaris/21/"></link><id>tag:hudson.dev.java.net,2009:vysper-trunk-jdk1.6-solaris:2009-06-01_18-36-43</id><published>2009-06-01T18:36:43Z</published><updated>2009-06-01T18:36:43Z</updated></entry></feed>';
var historicFeedParser = new HudsonHistoricFeedParser(1, 'overall');
var historicFeedResult = historicFeedParser.parse(historicFeedXml);
var historicBuilds = historicFeedResult.getBuilds();
var historicFeedParserWithSizeLargerThanNumOfEntries = new HudsonHistoricFeedParser(20);
describe('HistoricFeedParser', {
	'should return correct title': function() {
		value_of(historicFeedResult.getTitle()).should_be('vysper-trunk-jdk1.6-solaris all builds');
	},
	'should return correct number of builds': function() {
		value_of(historicBuilds.length).should_be(1);
	},
	'should return correct build name': function() {
		value_of(historicBuilds[0].getName()).should_be('vysper-trunk-jdk1.6-solaris #22 (SUCCESS)');
	},
	'should return correct build status': function() {
		value_of(historicBuilds[0].getStatus()).should_be('success');
	},
	'should return correct build url': function() {
		value_of(historicBuilds[0].getUrl()).should_be('http://hudson.zones.apache.org/hudson/job/vysper-trunk-jdk1.6-solaris/22/');
	},
	'should return correct build date': function() {
		value_of(historicBuilds[0].getDate().toString('dd-MM-yyyy hh:mm:ss')).should_be('01-06-2009 07:36:43');
	},
	'should return correct status': function() {
		value_of(historicFeedResult.getStatus()).should_be('health_80');
	},
	'should return correct number of builds when size is larger than num of entries': function() {
		value_of(historicFeedParserWithSizeLargerThanNumOfEntries.parse(historicFeedXml).getBuilds().length).should_be(2);
	}
})

//////////////////////////////////////////////////////////////////////// executorfeedparser
var executorFeedXml = '<computerSet><busyExecutors>2</busyExecutors><computer><displayName>master</displayName><executor><currentExecutable><number>138</number><url>http://hudson.zones.apache.org/hudson/job/Cactus/138/</url></currentExecutable><idle>false</idle><likelyStuck>false</likelyStuck><number>0</number><progress>34</progress></executor><executor><currentExecutable><number>307</number><url>http://hudson.zones.apache.org/hudson/job/ftpserver-trunk-jdk1.5-solaris/307/</url></currentExecutable><idle>false</idle><likelyStuck>true</likelyStuck><number>1</number><progress>99</progress></executor><icon>computer.gif</icon><idle>false</idle><jnlpAgent>false</jnlpAgent><launchSupported>true</launchSupported><manualLaunchAllowed>true</manualLaunchAllowed><monitorData><hudson.node_monitors.SwapSpaceMonitor><availablePhysicalMemory>197132288</availablePhysicalMemory><availableSwapSpace>6232735744</availableSwapSpace><totalPhysicalMemory>6441402368</totalPhysicalMemory><totalSwapSpace>10823401472</totalSwapSpace></hudson.node_monitors.SwapSpaceMonitor><hudson.node_monitors.ArchitectureMonitor>SunOS (x86)</hudson.node_monitors.ArchitectureMonitor><hudson.node_monitors.ResponseTimeMonitor><average>0</average></hudson.node_monitors.ResponseTimeMonitor><hudson.node_monitors.DiskSpaceMonitor>271497184256</hudson.node_monitors.DiskSpaceMonitor><hudson.node_monitors.ClockMonitor><diff>0</diff></hudson.node_monitors.ClockMonitor></monitorData><numExecutors>2</numExecutors><offline>false</offline><temporarilyOffline>false</temporarilyOffline></computer><computer><displayName>lucene.zones.apache.org (Solaris 10)</displayName><executor><idle>true</idle><likelyStuck>false</likelyStuck><number>0</number><progress>-1</progress></executor><icon>computer.gif</icon><idle>true</idle><jnlpAgent>false</jnlpAgent><launchSupported>true</launchSupported><manualLaunchAllowed>true</manualLaunchAllowed><monitorData><hudson.node_monitors.ArchitectureMonitor>SunOS (x86)</hudson.node_monitors.ArchitectureMonitor><hudson.node_monitors.ResponseTimeMonitor><average>66</average></hudson.node_monitors.ResponseTimeMonitor><hudson.node_monitors.DiskSpaceMonitor>340919224320</hudson.node_monitors.DiskSpaceMonitor><hudson.node_monitors.ClockMonitor><diff>23</diff></hudson.node_monitors.ClockMonitor></monitorData><numExecutors>1</numExecutors><offline>false</offline><temporarilyOffline>false</temporarilyOffline></computer></computerSet>'; 
var executorFeedParser = new HudsonExecutorFeedParser(20);
var executorFeedResult = executorFeedParser.parse(executorFeedXml);
var executorBuilds = executorFeedResult.getBuilds();
var activeExecutorBuild = executorBuilds[0];
var stuckExecutorBuild = executorBuilds[1];
var idleExecutorBuild = executorBuilds[2];
describe('ExecutorFeedParser', {
	'should return correct number of builds': function() {
		value_of(executorBuilds.length).should_be(3);
	},
	'should return correct status': function() {
		value_of(executorFeedResult.getStatus()).should_be('stuck');
	},
	'should return correct build name': function() {
		value_of(activeExecutorBuild.getName()).should_be('Cactus#138');
	},
	'should return correct build url': function() {
		value_of(activeExecutorBuild.getUrl()).should_be('http://hudson.zones.apache.org/hudson/job/Cactus/138/');
	},
	'should return false idle status for active build': function() {
		value_of(activeExecutorBuild.getIdle()).should_be_false();
	},
	'should return false stuck status for active build': function() {
		value_of(activeExecutorBuild.getStuck()).should_be_false();
	},
	'should return false idle status for stuck build': function() {
		value_of(stuckExecutorBuild.getIdle()).should_be_false();
	},
	'should return true stuck status for stuck build': function() {
		value_of(stuckExecutorBuild.getStuck()).should_be_true();
	},
	'should return correct details': function() {
		value_of(stuckExecutorBuild.getDetails()).should_be('99% - ftpserver-trunk-jdk1.5-solaris#307 - master#1');
	},
	'should return correct status': function() {
		value_of(stuckExecutorBuild.getStatus()).should_be('stuck');
	},
	'should return null name for idle build': function() {
		value_of(idleExecutorBuild.getName()).should_be_null();
	},
	'should return true idle status for idle build': function() {
		value_of(idleExecutorBuild.getIdle()).should_be_true();
	},
	'should return false stuck status for idle build': function() {
		value_of(idleExecutorBuild.getStuck()).should_be_false();
	},
	'should return correct details for idle build': function() {
		value_of(idleExecutorBuild.getDetails()).should_be('Idle - lucene.zones.apache.org (Solaris 10)#0');
	},
	'should return correct status for idle build': function() {
		value_of(idleExecutorBuild.getStatus()).should_be('idle');
	}
})

//////////////////////////////////////////////////////////////////////// menuitem
var menuItem = new HudsonMenuItem('MyJob #118 (SUCCESS)', 'http://localhost/hudson/job/MyJob/118/', 'orb.png');
describe('MenuItem', {
	'should return correct title': function() {
		value_of(menuItem.getTitle()).should_be('MyJob #118 (SUCCESS)');
	},
	'should return correct url': function() {
		value_of(menuItem.getUrl()).should_be('http://localhost/hudson/job/MyJob/118/');
	},
	'should return correct icon': function() {
		value_of(menuItem.getIcon()).should_be('orb.png');
	}
})

//////////////////////////////////////////////////////////////////////// logger
function MockLoggerService() {
	this.debug = function(message) {}
}
var mockControl = new MockControl();
var mockLoggerService = mockControl.createMock(MockLoggerService);
var mockPreferences = mockControl.createMock(HudsonPreferences);
var mockUtil = mockControl.createMock(HudsonUtil);
var enabledLogger = new HudsonLogger(mockLoggerService, mockUtil, mockPreferences);
mockPreferences.expects().getDebug().andReturn(true);
mockUtil.expects().getLogDate().andReturn('22 March 1980');
mockLoggerService.expects().debug('BuildMonitor [22 March 1980][main]: Starting...');
enabledLogger.debug('Starting...');
var enabledLoggerException = null;
try { mockControl.verify(); } catch (e) { enabledLoggerException = e; }
describe('Enabled Logger', {
	'should call console debug with correct message': function() {
		value_of(enabledLoggerException).should_be_null();
	}
})
var mockControl = new MockControl();
var mockLoggerService = mockControl.createMock(MockLoggerService);
var mockPreferences = mockControl.createMock(HudsonPreferences);
var mockUtil = mockControl.createMock(HudsonUtil);
var disabledLogger = new HudsonLogger(mockLoggerService, mockUtil, mockPreferences);
mockPreferences.expects().getDebug().andReturn(false);
disabledLogger.debug('Starting...');
var disabledLoggerException = null;
try { mockControl.verify(); } catch (e) { disabledLoggerException = e; }
describe('Disabled Logger', {
	'should not call console debug': function() {
		value_of(disabledLoggerException).should_be_null();
	}
})
var mockControl = new MockControl();
var mockLoggerService = mockControl.createMock(MockLoggerService);
var mockPreferences = mockControl.createMock(HudsonPreferences);
var mockUtil = mockControl.createMock(HudsonUtil);
var enabledLoggerWithFeed = new HudsonLogger(mockLoggerService, mockUtil, mockPreferences);
mockPreferences.expects().getDebug().andReturn(true);
mockUtil.expects().getLogDate().andReturn('28 May 1980');
mockLoggerService.expects().debug('BuildMonitor [28 May 1980][0-My Feed]: Starting...');
var feed = new HudsonFeed(0, 'My Feed', 'http://localhost/hudson/job/MyJob/rssAll', lastFailDate);
enabledLoggerWithFeed.debug('Starting...', feed);
var enabledLoggerWithFeedException = null;
try { mockControl.verify(); } catch (e) { enabledLoggerWithFeedException = e; }
describe('Enabled Logger w/ Feed', {
	'should call console debug with feed name in the message': function() {
		value_of(enabledLoggerWithFeedException).should_be_null();
	}
})

//////////////////////////////////////////////////////////////////////// notification
function MockNotificationService() {
	this.displayAlert = function(type, title, feed, build) {}
	this.playSound = function(feed) {}
}
var mockControl = new MockControl();
var mockPreferences = mockControl.createMock(HudsonPreferences);
var mockNotificationService = mockControl.createMock(MockNotificationService);
var mockFeed = mockControl.createMock(HudsonFeed);
var mockBuild = mockControl.createMock(HudsonBuild);
var type = TYPE_EXECUTOR;
mockPreferences.expects().getAlert().andReturn(true);
mockNotificationService.expects().displayAlert(type, 'some title', mockFeed, mockBuild);
mockPreferences.expects().getSound().andReturn(true);
mockNotificationService.expects().playSound(mockBuild);
var notification = new HudsonNotification(mockNotificationService, mockPreferences);
notification.displayAlert(type, mockFeed, mockBuild, 'some title');
notification.playSound(mockBuild);
var notificationException = null;
try { mockControl.verify(); } catch (e) { notificationException = e; }
describe('Notification', {
	'should call notification service methods': function() {
		value_of(notificationException).should_be_null();
	}
})

//////////////////////////////////////////////////////////////////////// preferences
function MockPreferencesService() {
	this.getBoolean = function(key) {}
	this.getString = function(key) {}
	this.getInteger = function(key) {}
}
var mockControl = new MockControl();
var mockPreferencesService = mockControl.createMock(MockPreferencesService);
var preferences = new HudsonPreferences(mockPreferencesService, 2);
mockPreferencesService.expects().getBoolean('hudson.debug').andReturn(false);
mockPreferencesService.expects().getString('hudson.successcolor').andReturn('green');
mockPreferencesService.expects().getString('hudson.feedstatustype').andReturn('health');
mockPreferencesService.expects().getInteger('hudson.interval').andReturn(5);
mockPreferencesService.expects().getString('hudson.openpage').andReturn('newtab');
mockPreferencesService.expects().getInteger('hudson.size').andReturn(20);
mockPreferencesService.expects().getBoolean('hudson.sound').andReturn(true);
mockPreferencesService.expects().getBoolean('hudson.alert').andReturn(true);
mockPreferencesService.expects().getBoolean('hudson.hidename').andReturn(false);
mockPreferencesService.expects().getBoolean('hudson.executor').andReturn(true);
mockPreferencesService.expects().getString('hudson.networkusername').andReturn('myusername');
mockPreferencesService.expects().getString('hudson.networkpassword').andReturn('mypassword');
mockPreferencesService.expects().getBoolean('hudson.identifyrsspattern').andReturn(true);
mockPreferencesService.expects().getString('hudson.feeds.0.name').andReturn('My Feed');
mockPreferencesService.expects().getString('hudson.feeds.0.url').andReturn('http://localhost/hudson/job/MyJob/rssAll');
mockPreferencesService.expects().getString('hudson.feeds.0.lastfail').andReturn(lastFailDate);
mockPreferencesService.expects().getString('hudson.feeds.1.name').andReturn('Your Feed');
mockPreferencesService.expects().getString('hudson.feeds.1.url').andReturn('http://localhost/hudson/job/YourJob/rssAll');
mockPreferencesService.expects().getString('hudson.feeds.1.lastfail').andReturn(lastFailDate);
var debug = preferences.getDebug();
var successColor = preferences.getSuccessColor();
var feedStatusType = preferences.getFeedStatusType();
var interval = preferences.getInterval();
var openPage = preferences.getOpenPage();
var size = preferences.getSize();
var sound = preferences.getSound();
var alert = preferences.getAlert();
var hideName = preferences.getHideName();
var executor = preferences.getExecutor();
var networkUsername = preferences.getNetworkUsername();
var networkPassword = preferences.getNetworkPassword();
var identifyRssPattern = preferences.getIdentifyRssPattern();
var feeds = preferences.getFeeds();
var preferencesException = null;
try { mockControl.verify(); } catch (e) { preferencesException = e; }
describe('Preferences', {
	'should call preferences methods with correct args': function() {
		value_of(preferencesException).should_be_null();
	},
	'should return correct debug status': function() {
		value_of(debug).should_be_false();
	},
	'should return correct success color': function() {
		value_of(successColor).should_be('green');
	},
	'should return correct feed status type': function() {
		value_of(feedStatusType).should_be('health');
	},
	'should return correct interval': function() {
		value_of(interval).should_be(5);
	},
	'should return correct open page': function() {
		value_of(openPage).should_be('newtab');
	},
	'should return correct size': function() {
		value_of(size).should_be(20);
	},
	'should return correct sound status': function() {
		value_of(sound).should_be_true();
	},
	'should return correct alert status': function() {
		value_of(alert).should_be_true();
	},
	'should return correct hide name status': function() {
		value_of(hideName).should_be_false();
	},
	'should return correct executor status': function() {
		value_of(executor).should_be_true();
	},
	'should return correct network username': function() {
		value_of(networkUsername).should_be('myusername');
	},
	'should return correct network password': function() {
		value_of(networkPassword).should_be('mypassword');
	},
	'should return correct identify RSS pattern status': function() {
		value_of(identifyRssPattern).should_be_true();
	},
	'should return correct debug status': function() {
		value_of(debug).should_be_false();
	},
	'should return correct number of feeds': function() {
		value_of(feeds.length).should_be(2);
	}
})

//////////////////////////////////////////////////////////////////////// util
var util = new HudsonUtil();
describe('Util', {
	'should return correct boolean value when passed string true': function() {
		value_of(util.getBoolean('true')).should_be_true();
	},
	'should return correct boolean value when passed string false': function() {
		value_of(util.getBoolean('false')).should_be_false();
	},
	'should return correct integer value': function() {
		value_of(util.getInteger('42')).should_be(42);
	},
	'should return true for rss url': function() {
		value_of(util.isHudsonRss('http://localhost/hudson/job/MyJob/rssAll')).should_be_true();
	},
	'should return false for non rss url': function() {
		value_of(util.isHudsonRss('http://localhost')).should_be_false();
	}
})

//////////////////////////////////////////////////////////////////////// firefox
////////////////////////////////////////////////////////////////////////

//////////////////////////////////////////////////////////////////////// localiser
function MockBundle() {
	this.getFormattedString = function(key, args) {}
	this.getString = function(key) {}
}
var mockControl = new MockControl();
var mockBundle = mockControl.createMock(MockBundle);
var simpleLocaliser = new HudsonLocaliser();
simpleLocaliser.setBundle(mockBundle);
mockBundle.expects().getString('monitor.init').andReturn('Initialising monitor.');
var simpleText = simpleLocaliser.getText('monitor.init');
var simpleLocaliserException = null;
try { mockControl.verify(); } catch (e) { simpleLocaliserException = e; }
describe('Simple Localiser', {
	'should call bundle getString with correct key': function() {
		value_of(simpleLocaliserException).should_be_null();
	},
	'should return correct text': function() {
		value_of(simpleText).should_be('Initialising monitor.');
	}
})
var mockControl = new MockControl();
var mockBundle = mockControl.createMock(MockBundle);
var dummyArgs = new Array();
var formattedLocaliser = new HudsonLocaliser();
formattedLocaliser.setBundle(mockBundle);
mockBundle.expects().getFormattedString('menu.add.linkdiscovery', dummyArgs).andReturn('Add \'My Feed\' To Hudson Build Monitor');
var formattedText = formattedLocaliser.getText('menu.add.linkdiscovery', dummyArgs);
var formattedLocaliserException = null;
try { mockControl.verify(); } catch (e) { formattedLocaliserException = e; }
describe('Formatted Localiser', {
	'should call bundle getFormattedString with correct key and args': function() {
		value_of(formattedLocaliserException).should_be_null();
	},
	'should return correct text': function() {
		value_of(formattedText).should_be('Add \'My Feed\' To Hudson Build Monitor');
	}
})

//////////////////////////////////////////////////////////////////////// loggerservice
function MockFfConsoleService() {
	this.logStringMessage = function(message) {}
}
var mockControl = new MockControl();
var mockFfConsoleService = mockControl.createMock(MockFfConsoleService);
mockFfConsoleService.expects().logStringMessage('Some message');
var loggerService = new HudsonLoggerService(mockFfConsoleService);
loggerService.debug('Some message');
var loggerServiceException = null;
try { mockControl.verify(); } catch (e) { loggerServiceException = e; }
describe('LoggerService', {
	'should call logger service methods': function() {
		value_of(loggerServiceException).should_be_null();
	}
})

//////////////////////////////////////////////////////////////////////// notificationservice
function MockUri() {
}
function MockFeed() {
	this.getStatus = function() {}
	this.getName = function() {}
}
function MockBuild() {
	this.getDetails = function() {}
}
function MockFfAlertsService() {
	this.showAlertNotification = function(imageUrl, title, text, textClickable) {}
}
function MockFfSoundService() {
	this.play = function(aURL) {}
}
function MockFfIoService() {
	this.newURI = function(aSpec, aOriginCharset, aBaseURI) {}
}
var mockControl = new MockControl();
var mockFeed = mockControl.createMock(MockFeed);
var mockBuild = mockControl.createMock(MockBuild);
var mockFfAlertsService = mockControl.createMock(MockFfAlertsService);
var mockFfSoundService = mockControl.createMock(MockFfSoundService);
var mockFfIoService = mockControl.createMock(MockFfIoService);
var mockUri = mockControl.createMock(MockUri);
var notificationService = new HudsonNotificationService(mockFfAlertsService, mockFfSoundService, mockFfIoService);
mockBuild.expects().getStatus().andReturn('stuck');
mockFeed.expects().getName().andReturn('TheirJob');
mockBuild.expects().getDetails().andReturn('some details');
mockFfAlertsService.expects().showAlertNotification('chrome://buildmonitor/skin/build/stuck.png', 'some title [TheirJob]', 'some details', false);
mockFeed.expects().getStatus().andReturn('stuck');
mockFfIoService.expects().newURI('chrome://buildmonitor/skin/audio/stuck.wav', null, null).andReturn(mockUri);
mockFfSoundService.expects().play(mockUri); 
notificationService.displayAlert(TYPE_HISTORIC, 'some title', mockFeed, mockBuild);
notificationService.playSound(mockBuild);
var notificationServiceException = null;
try { mockControl.verify(); } catch (e) { notificationServiceException = e; }
describe('NotificationService', {
	'should call notification service methods': function() {
		value_of(notificationServiceException).should_be_null();
	}
})

//////////////////////////////////////////////////////////////////////// preferencesservice
function MockFfPreferencesService() {
	this.getBoolPref = function(key) {}
	this.setBoolPref = function(key, value) {}
	this.getCharPref = function(key) {}
	this.setCharPref = function(key, value) {}
	this.getIntPref = function(key) {}
	this.setIntPref = function(key, value) {}
}
var mockControl = new MockControl();
var mockFfPreferencesService = mockControl.createMock(MockFfPreferencesService);
mockFfPreferencesService.expects().getBoolPref('hudson.bool.key').andReturn(true);
mockFfPreferencesService.expects().setBoolPref('hudson.bool.key', true);
mockFfPreferencesService.expects().getCharPref('hudson.char.key').andReturn('some char value');
mockFfPreferencesService.expects().setCharPref('hudson.char.key', 'some char value');
mockFfPreferencesService.expects().getIntPref('hudson.int.key').andReturn(88);
mockFfPreferencesService.expects().setIntPref('hudson.int.key', 88);
var preferencesService = new HudsonPreferencesService(mockFfPreferencesService);
var preferenceBooleanValue = preferencesService.getBoolean('hudson.bool.key');
preferencesService.setBoolean('hudson.bool.key', true);
var preferenceStringValue = preferencesService.getString('hudson.char.key');
preferencesService.setString('hudson.char.key', 'some char value');
var preferenceIntegerValue = preferencesService.getInteger('hudson.int.key');
preferencesService.setInteger('hudson.int.key', 88);
var preferencesServiceException = null;
try { mockControl.verify(); } catch (e) { preferencesServiceException = e; }
describe('PreferencesService', {
	'should call preferences service methods': function() {
		value_of(preferencesServiceException).should_be_null();
	},
	'should return correct boolean value': function() {
		value_of(preferenceBooleanValue).should_be_true();
	},
	'should return correct string value': function() {
		value_of(preferenceStringValue).should_be('some char value');
	},
	'should return correct integer value': function() {
		value_of(preferenceIntegerValue).should_be(88);
	}
})

// ]]></script>
</head>
<body></body>
</html>