<j:jelly xmlns:j="jelly:core" xmlns:st="jelly:stapler" xmlns:d="jelly:define"
	xmlns:l="/lib/layout" xmlns:t="/lib/hudson" xmlns:f="/lib/form"
	xmlns:i="jelly:fmt">
    <j:new var="h" className="hudson.Functions" />
    <j:set var="descriptor" value="${it.descriptor}" />
	${h.checkPermission(it, it.PERMISSION)}
	<l:layout title="Sounds">
		<l:side-panel>
			<l:tasks>
				<l:task icon="images/24x24/up.gif" href="${rootURL}/" title="${%Back to Dashboard}" />
				<l:task icon="plugin/sounds/icon/s_${it.globalMute?'off':'on'}_24x24.png" href="globalMute" title="${it.globalMute?'Enable':'Disable ALL'} sounds${it.globalMute?' (currently disabled)':''}" />
				<j:if test="${!it.globalMute}">
					<l:task icon="plugin/sounds/icon/s_${it.localMute?'off':'on'}_24x24.png" href="localMute" title="Local mute${it.localMute?' (currently muted)':''}" />
		 			<l:task icon="plugin/sounds/icon/s_off_24x24.png" href="cancelSounds" title="${%Cancel all playing sounds}" />
				</j:if>
			</l:tasks>
		</l:side-panel>
		<l:main-panel>
			<h1>Sound Control Panel</h1>
			<f:form method="post" action="">
				<f:section title="Play sound from internal sound archive">
					<f:entry title="Test sound" field="sound">
						<input type="hidden" name="_.selectedSound" />
						<select class="setting-input" name="_.sound" onchange="findPrevious(this, function(){return true}).value = this.value">
							<option value="">(choose a sound)</option>
							<j:forEach var="s" items="${descriptor.sounds}">
								<f:option value="${s.id}">${s.description}</f:option>
							</j:forEach>
						</select>
					</f:entry>
					<f:validateButton method="testSound" title="Test" with="selectedSound" />
				</f:section>
				<f:section title="Play sound from a URL">
					<f:entry title="URL" field="soundUrl">
						<f:textbox />
					</f:entry>
					<f:validateButton method="testUrl" title="Test" with="soundUrl" />
				</f:section>
			</f:form>
			<p>
				<div class="help" style="display: block">
					<h2>Playing sounds:</h2>
					Sounds can be triggered using:
					<ul>
						<li>a Job build action</li>
						<li>a Job notifier rule (e.g. on failure)</li>
						<li>by making an HTTP request to ${h.inferHudsonURL(request)}sounds/playSound?src=&amp;lt;URL&gt; (currently only supported in BROWSER mode)</li>
						<li>embed a Sounds agent in any other site (see <a href="${h.inferHudsonURL(request)}sounds/jsonpdemo">${h.inferHudsonURL(request)}sounds/jsonpdemo</a>)</li>
					</ul>
					<h2>Troubleshooting tips:</h2>
					If sound does not work some of the checks below might lead you to a solution:
					<ul>
						<li>Check the system is configured properly:</li>
						<ul>
							<li>Sound output option in System Configuration (currently '${it.soundsDescriptor.playMethod}').</li>
							<ul>
								<li>LOCAL hardware - check your sound hardware and that it is detected by Java.</li>
								<li>BROWSER - check Hudson URL (currently ${h.inferHudsonURL(request)}).</li>
								<li>PIPE - check that command can connect without password prompt.</li>
							</ul>
						</ul>
						<li>Check sound file formats.</li>
						<ul>
							<li>WAV is generally supported, but some WAV files use MPEG which is not.</li>
							<li>AU and AIFF are normally supported.</li>
							<li>MP3 is not widely supported.</li>
							<li>OGG should work everywhere.</li>
						</ul>
						<li>Check browser capability.</li>
						<ul>
							<li>If using the BROWSER option, your browser must be HTML5 Audio capable.</li>
						</ul>
						<li>Sounds are not muted.</li>
						<ul>
							<li>If using the BROWSER option, browsers may take up to 1 minute to begin to play sounds after being un-muted.</li>
						</ul>
					</ul>
				</div>
			</p>
		</l:main-panel>
	</l:layout>
</j:jelly>
