<?xml version="1.0" ?>
<project name="japex" default="jar">

  <target name="compile" >
    <mkdir dir="build/classes"/>
    <javac srcdir="src" destdir="build/classes" debug="on">
      <classpath>
        <fileset dir="../../hudson/resources/WEB-INF/lib" includes="**/*.jar"/>
        <fileset dir="../../hudson/lib" includes="**/*.jar"/>
        <fileset dir="lib" includes="**/*.jar"/>
        <pathelement path="../../hudson/build/classes" />
      </classpath>
    </javac>
  </target>

  <target name="jar" depends="compile">
    <jar destfile="build/japex.hpi">
      <zipfileset dir="build/classes" prefix="WEB-INF/classes"/>
      <zipfileset dir="views" prefix="WEB-INF/classes"/>
      <zipfileset dir="resources" />
      <zipfileset dir="lib" prefix="WEB-INF/lib" includes="**/*.jar"/>
      <manifest>
        <attribute name="Build-Id" value="${build.version}"/>
        <attribute name="Plugin-Class" value="hudson.plugins.japex.PluginImpl" />
        <attribute name="Long-Name" value="Hudson japex plug-in" />
      </manifest>
    </jar>
  </target>

  <target name="clean">
    <delete dir="build"/>
  </target>

  <target name="deploy" depends="jar">
    <copy todir="../../../work/plugins" file="build/japex.hpi" />
  </target>
</project>
