<j:jelly xmlns:j="jelly:core" xmlns:st="jelly:stapler" xmlns:d="jelly:define" xmlns:l="/lib/layout" xmlns:t="/lib/hudson" xmlns:f="/lib/form" xmlns:i="jelly:fmt">

    <script type="text/javascript">
    function showFailures() {

        var elms = document.getElementsByClassName("hidden");
        for(var i = 0; i &lt; elms.length; i++) {
            elms[i].style.display = "";
        }
        elm = document.getElementById("showLink");
        elm.style.display = "none";
    }
    </script>

    <!-- summary -->
    <t:summary icon="clipboard.gif">
    <a href="${it.urlName}/">${it.displayName}</a>
    <t:test-result />

    <!-- FIXME: Make it work with TestCollections -->
    <j:set var="failedTests" value="${it.result.failedTests}" />
    <j:if test="${failedTests != null}">
        <j:set var="failedIterator" value="${failedTests.iterator()}" />
        <j:set var="displayedCount" value="${1}" />        
        <ul style="list-style-type: none; margin: 0;">
            <j:while test="${failedIterator.hasNext()}">
                <j:set var="testObject" value="${failedIterator.next()}" />
                <j:if test="${testObject.fullName != null}">
                    <!-- CaseResult -->
                    <j:set var="elementClass" value="hidden" />
                    <j:set var="elementStyle" value="display:none" />
                    
                    <!-- Show max 10 failures from this build -->
                    <j:if test="${((testObject.age == 1) &amp;&amp; (displayedCount &lt;= 10))}"> 
                        <j:set var="displayedCount" value="${displayedCount + 1}" />
                        <j:set var="elementClass" value="shown" />
                        <j:set var="elementStyle" value="" />
                    </j:if>

                    <li class="${elementClass}" style="${elementStyle}">
                        <a href="testReport/${testObject.getRelativePathFrom(it.result)}">
                        ${testObject.fullName}
                        </a>
                    </li>
                </j:if>
            </j:while>
        </ul>

        <!-- Show failures link -->
        <j:if test="${displayedCount &lt; failedTests.size() }">
            <a id="showLink" name="editFailuresLink"
                href="#showFailuresLink"
                onclick="javascript:showFailures()">Show all failed tests ${">>>"}</a>
        </j:if>
    </j:if>
    

  </t:summary>
</j:jelly>
